import numpy as np
import matplotlib
import matplotlib.pyplot as plt
from scipy.fft import fft2, ifft2
from physunits import m, cm, mm, nm, um
import scipy.constants as const
import xri
from scipy.ndimage import gaussian_filter
from scipy.ndimage import zoom
    
plt.rcParams['figure.dpi'] = 200

### LOAD ###

# _1m_1 = np.load("1m_I2_1.npy")
# _1m_2 = np.load("1m_I2_2.npy")
# _1m_3 = np.load("1m_I2_3.npy")    
# _1m_4 = np.load("1m_I2_4.npy")
# _1m_5 = np.load("1m_I2_5.npy")
# _1m_6 = np.load("1m_I2_6.npy")
# _1m_7 = np.load("1m_I2_7.npy")
# _1m_8 = np.load("1m_I2_8.npy")
# _1m_9 = np.load("1m_I2_9.npy")

# _2_5m_1 = np.load("2.5m_I2_1.npy")
# _2_5m_2 = np.load("2.5m_I2_2.npy")
# _2_5m_3 = np.load("2.5m_I2_3.npy")    
# _2_5m_4 = np.load("2.5m_I2_4.npy")
# _2_5m_5 = np.load("2.5m_I2_5.npy")
# _2_5m_6 = np.load("2.5m_I2_6.npy")
# _2_5m_7 = np.load("2.5m_I2_7.npy")
# _2_5m_8 = np.load("2.5m_I2_8.npy")
# _2_5m_9 = np.load("2.5m_I2_9.npy")

# _5m_1 = np.load("5m_I2_1.npy")
# _5m_2 = np.load("5m_I2_2.npy")
# _5m_3 = np.load("5m_I2_3.npy")    
# _5m_4 = np.load("5m_I2_4.npy")
# _5m_5 = np.load("5m_I2_5.npy")
# _5m_6 = np.load("5m_I2_6.npy")
# _5m_7 = np.load("5m_I2_7.npy")
# _5m_8 = np.load("5m_I2_8.npy")
# # _5m_9 = np.load("5m_I2_9.npy")

## LOAD: LAB M = 2.5

_1m_1 = np.load("1m_I2_1_M=2.5.npy")
_1m_2 = np.load("1m_I2_2_M=2.5.npy")
_1m_3 = np.load("1m_I2_3_M=2.5.npy")   
_1m_4 = np.load("1m_I2_4_M=2.5.npy")
_1m_5 = np.load("1m_I2_5_M=2.5.npy")
_1m_6 = np.load("1m_I2_6_M=2.5.npy")
_1m_7 = np.load("1m_I2_7_M=2.5.npy")
_1m_8 = np.load("1m_I2_8_M=2.5.npy")
_1m_9 = np.load("1m_I2_9_M=2.5.npy")

_2_5m_1 = np.load("2.5m_I2_1_M=2.5.npy")
_2_5m_2 = np.load("2.5m_I2_2_M=2.5.npy")
_2_5m_3 = np.load("2.5m_I2_3_M=2.5.npy")    
_2_5m_4 = np.load("2.5m_I2_4_M=2.5.npy")
_2_5m_5 = np.load("2.5m_I2_5_M=2.5.npy")
_2_5m_6 = np.load("2.5m_I2_6_M=2.5.npy")
_2_5m_7 = np.load("2.5m_I2_7_M=2.5.npy")
_2_5m_8 = np.load("2.5m_I2_8_M=2.5.npy")
_2_5m_9 = np.load("2.5m_I2_9_M=2.5.npy")

_5m_1 = np.load("5m_I2_1_M=2.5.npy")
_5m_2 = np.load("5m_I2_2_M=2.5.npy")
_5m_3 = np.load("5m_I2_3_M=2.5.npy")  
_5m_4 = np.load("5m_I2_4_M=2.5.npy")
_5m_5 = np.load("5m_I2_5_M=2.5.npy")
_5m_6 = np.load("5m_I2_6_M=2.5.npy")
_5m_7 = np.load("5m_I2_7_M=2.5.npy")
_5m_8 = np.load("5m_I2_8_M=2.5.npy")
_5m_9 = np.load("5m_I2_9_M=2.5.npy")


### UPSAMPLE! ###

_1m_1 = zoom(_1m_1, 0.25, order=3)
_1m_2 = zoom(_1m_2, 0.25, order=3)
_1m_3 = zoom(_1m_3, 0.25, order=3)
_1m_4 = zoom(_1m_4, 0.25, order=3)
_1m_5 = zoom(_1m_5, 0.25, order=3)
_1m_6 = zoom(_1m_6, 0.25, order=3)
_1m_7 = zoom(_1m_7, 0.25, order=3)
_1m_8 = zoom(_1m_8, 0.25, order=3)
_1m_9 = zoom(_1m_9, 0.25, order=3)

_2_5m_1 = zoom(_2_5m_1, 0.25, order=3)
_2_5m_2 = zoom(_2_5m_2, 0.25, order=3)
_2_5m_3 = zoom(_2_5m_3, 0.25, order=3)
_2_5m_4 = zoom(_2_5m_4, 0.25, order=3)
_2_5m_5 = zoom(_2_5m_5, 0.25, order=3)
_2_5m_6 = zoom(_2_5m_6, 0.25, order=3)
_2_5m_7 = zoom(_2_5m_7, 0.25, order=3)
_2_5m_8 = zoom(_2_5m_8, 0.25, order=3)
_2_5m_9 = zoom(_2_5m_9, 0.25, order=3)

_5m_1 = zoom(_5m_1, 0.25, order=3)
_5m_2 = zoom(_5m_2, 0.25, order=3)
_5m_3 = zoom(_5m_3, 0.25, order=3)
_5m_4 = zoom(_5m_4, 0.25, order=3)
_5m_5 = zoom(_5m_5, 0.25, order=3)
_5m_6 = zoom(_5m_6, 0.25, order=3)
_5m_7 = zoom(_5m_7, 0.25, order=3)
_5m_8 = zoom(_5m_8, 0.25, order=3)
_5m_9 = zoom(_5m_9, 0.25, order=3)


# # DIFFERENT ENERGY PEAKS @ SAME PROP DISTANCES ###

plt.plot(_1m_1[-1], label="E = 8.1 keV")
plt.plot(_1m_2[-1], label="E = 9.7 keV")
plt.plot(_1m_3[-1], label="E = 11.2 keV")
plt.plot(_1m_6[-1], label="E = 19 keV")
plt.plot(_1m_7[-1], label="E = 25 keV")
# plt.axvline(107, color="pink", ls=":", label=r"W peak at $z_{\mathrm{eff}}$ = 1 m")
# plt.axvline(917, color="pink", ls=":")
plt.legend()
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title(r"Tungsten peaks $z_{eff} = 1 m$")
plt.show()

plt.plot(_1m_4[-1], label="E = 21.99 keV")
plt.plot(_1m_5[-1], label="E = 24.911 keV")
plt.plot(_1m_8[-1], label="E = 30 keV")
plt.plot(_1m_9[-1], label="E = 35 keV")
# plt.axvline(109, color="grey", ls=":", label=r"Ag peak at $z_{\mathrm{eff}}$ = 1 m")
# plt.axvline(915, color="grey", ls=":")
plt.legend()
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title("Silver peaks $z_{eff} = 1 m$")
plt.show()


## SAME ENERGY PEAKS @ DIFFERENT PROP DISTANCES ###

plt.plot(_1m_1[-1], label=r"$z_{\mathrm{eff}}$ = 1 m")
plt.plot(_2_5m_1[-1], label=r"$z_{\mathrm{eff}}$ = 2.5 m")
plt.plot(_5m_1[-1], label=r"$z_{\mathrm{eff}}$ = 5 m")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title("Intensity profiles W at 8.1 keV")
plt.legend()
plt.show()

plt.plot(_1m_2[-1], label=r"$z_{\mathrm{eff}}$ = 1 m")
plt.plot(_2_5m_2[-1], label=r"$z_{\mathrm{eff}}$ = 2.5 m")
plt.plot(_5m_2[-1], label=r"$z_{\mathrm{eff}}$ = 5 m")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title("Intensity profiles W at 9.7 keV")
plt.legend()
plt.show()

plt.plot(_1m_3[-1], label=r"$z_{\mathrm{eff}}$ = 1 m")
plt.plot(_2_5m_3[-1], label=r"$z_{\mathrm{eff}}$ = 2.5 m")
plt.plot(_5m_3[-1], label=r"$z_{\mathrm{eff}}$ = 5 m")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title("Intensity profiles W at 11.2 keV")
plt.legend()
plt.show()

plt.plot(_1m_4[-1], label=r"$z_{\mathrm{eff}}$ = 1 m")
plt.plot(_2_5m_4[-1], label=r"$z_{\mathrm{eff}}$ = 2.5 m")
plt.plot(_5m_4[-1], label=r"$z_{\mathrm{eff}}$ = 5 m")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title("Intensity profiles Ag at 21.99 keV")
plt.legend()
plt.show()

plt.plot(_1m_5[-1], label=r"$z_{\mathrm{eff}}$ = 1 m")
plt.plot(_2_5m_5[-1], label=r"$z_{\mathrm{eff}}$ = 2.5 m")
plt.plot(_5m_5[-1], label=r"$z_{\mathrm{eff}}$ = 5 m")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title("Intensity profiles Ag at 24.911 keV")
plt.legend()
plt.show()


### AS vs TIE vs TIE+RK ###

# _1m_1_1 = np.load("1m_I1_1.npy")
# _1m_3_1 = np.load("1m_I3_1.npy")
_1m_1_1 = np.load("1m_I1_1_M=2.5.npy")
_1m_3_1 = np.load("1m_I3_1_M=2.5.npy")
_1m_1_1 = zoom(_1m_1_1, 0.25, order=3)
_1m_3_1 = zoom(_1m_3_1, 0.25, order=3)
plt.plot(_1m_1_1[-10], label="AS")
plt.plot(_1m_3_1[-10], label="xri's TIE")
plt.plot(_1m_1[-10], label="TIE+RK")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.legend()
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title(R"Tungsten $8.1$ keV peak at $z_{eff} = 1$ m")
plt.show()

# _1m_1_4 = np.load("1m_I1_4.npy")
# _1m_3_4 = np.load("1m_I3_4.npy")
_1m_1_4 = np.load("1m_I1_4_M=2.5.npy")
_1m_3_4 = np.load("1m_I3_4_M=2.5.npy")
_1m_1_4 = zoom(_1m_1_4, 0.25, order=3)
_1m_3_4 = zoom(_1m_3_4, 0.25, order=3)
plt.plot(_1m_1_4[-10], label="AS")
plt.plot(_1m_3_4[-10], label="xri's TIE")
plt.plot(_1m_4[-10], label="TIE+RK")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.legend()
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title(R"Silver 21.99 keV peak at $z_{eff} = 1$ m")
plt.show()

# _1m_1_5 = np.load("1m_I1_5.npy")
# _1m_3_5 = np.load("1m_I3_5.npy")
_1m_1_5 = np.load("1m_I1_5_M=2.5.npy")
_1m_3_5 = np.load("1m_I3_5_M=2.5.npy")
_1m_1_5 = zoom(_1m_1_5, 0.25, order=3)
_1m_3_5 = zoom(_1m_3_5, 0.25, order=3)
plt.plot(_1m_1_5[-10], label="AS")
plt.plot(_1m_3_5[-10], label="xri's TIE")
plt.plot(_1m_5[-10], label="TIE+RK")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.legend()
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title(R"Silver 24.911 keV peak at $z_{eff} = 1$ m")
plt.show()

### 2.5 m ###

# _2_5m_1_1 = np.load("2.5m_I1_1.npy")
# _2_5m_3_1 = np.load("2.5m_I3_1.npy")
_2_5m_1_1 = np.load("2.5m_I1_5_M=2.5.npy")
_2_5m_3_1 = np.load("2.5m_I3_5_M=2.5.npy")
_2_5m_1_1 = zoom(_2_5m_1_1, 0.25, order=3)
_2_5m_3_1 = zoom(_2_5m_3_1, 0.25, order=3)
plt.plot(_2_5m_1_1[-10], label="AS")
plt.plot(_2_5m_3_1[-10], label="xri's TIE")
plt.plot(_2_5m_1[-10], label="TIE+RK")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.legend()
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title(R"Tungsten $8.1$ keV peak at $z_{eff} = 2.5$ m")
plt.show()

# _2_5m_1_4 = np.load("2.5m_I1_4.npy")
# _2_5m_3_4 = np.load("2.5m_I3_4.npy")
_2_5m_1_4 = np.load("2.5m_I1_4_M=2.5.npy")
_2_5m_3_4 = np.load("2.5m_I3_4_M=2.5.npy")
_2_5m_1_4 = zoom(_2_5m_1_4, 0.25, order=3)
_2_5m_3_4 = zoom(_2_5m_3_4, 0.25, order=3)
plt.plot(_2_5m_1_4[-10], label="AS")
plt.plot(_2_5m_3_4[-10], label="xri's TIE")
plt.plot(_2_5m_4[-10], label="TIE+RK")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.legend()
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title(R"Silver 21.99 keV peak at $z_{eff} = 2.5$ m")
plt.show()

# _2_5m_1_5 = np.load("2.5m_I1_5.npy")
# _2_5m_3_5 = np.load("2.5m_I3_5.npy")
_2_5m_1_5 = np.load("2.5m_I1_5_M=2.5.npy")
_2_5m_3_5 = np.load("2.5m_I3_5_M=2.5.npy")
_2_5m_1_5 = zoom(_2_5m_1_5, 0.25, order=3)
_2_5m_3_5 = zoom(_2_5m_3_5, 0.25, order=3)
plt.plot(_2_5m_1_5[-10], label="AS")
plt.plot(_2_5m_3_5[-10], label="xri's TIE")
plt.plot(_2_5m_5[-10], label="TIE+RK")
plt.grid(color='grey', linestyle=':', linewidth=0.4)
plt.legend()
plt.xlabel("x")
plt.ylabel("I(x)")
plt.title(R"Silver 24.911 keV peak at $z_{eff} = 2.5$ m")
plt.show()